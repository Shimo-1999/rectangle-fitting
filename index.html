<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Rectangle Fitting</title>

  <!-- Bootswatch (Flatly) + Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5/dist/flatly/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
  <noscript>
    <div class="alert alert-warning text-center m-0 rounded-0">
      このアプリは JavaScript を使用します。ブラウザの設定で有効にしてください。
    </div>
  </noscript>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-xxl">
      <a class="navbar-brand brand d-flex align-items-center gap-2" href="#">
        <span>Rectangle Fitting</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-3">
        <a class="btn btn-outline-light btn-sm" href="https://github.com/Shimo-1999/rectangle-fitting" target="_blank" rel="noopener">
          <i class="bi bi-github" aria-hidden="true"></i> GitHub
        </a>
      </div>
    </div>
  </nav>

  <main class="container-xxl my-4">
    <div class="row align-items-stretch">
      <!-- Left: Settings -->
      <div class="col-12 col-lg-4" aria-labelledby="settings-heading">
        <h3 id="settings-heading" class="section-title mb-3">操作</h3>

        <form id="controls" class="d-flex flex-column gap-4" novalidate>

          <!-- STEP 1 -->
          <fieldset class="d-flex flex-column gap-2 border-0 p-0 m-0">
            <legend class="visually-hidden">画像選択</legend>
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-1-circle fs-5 text-primary" aria-hidden="true"></i>
              <h4 class="mb-1">画像選択</h4>
            </div>
            <div id="notice" class="d-none" role="status" aria-live="polite" aria-atomic="true"></div>
            <div class="d-flex flex-column">
              <label for="fileInput" class="form-label mb-1 small text-muted">ファイル</label>
              <input type="file" id="fileInput" class="form-control form-control-sm" accept="image/png,image/jpeg,image/webp,image/gif,image/svg+xml" aria-describedby="fileHelp">
              <div id="fileHelp" class="form-text small">
                未選択時は
                <a href="https://commons.wikimedia.org/wiki/File:Parrot.jpg"
                  target="_blank" rel="noopener" title="出典（Wikimedia Commons）">
                  <code>Parrot.jpg</code>
                </a>
                を使用します（
                <a class="link-secondary"
                  href="https://creativecommons.org/licenses/by-sa/4.0/"
                  target="_blank" rel="noopener" title="CC BY-SA 4.0（ライセンス本文）">
                  CC BY-SA 4.0
                </a>
                ）。
              </div>
            </div>
          </fieldset>

          <!-- STEP 2 -->
          <fieldset class="d-flex flex-column gap-2 border-0 p-0 m-0">
            <legend class="visually-hidden">アルゴリズム選択</legend>
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-2-circle fs-5 text-primary" aria-hidden="true"></i>
              <h4 class="mb-1">アルゴリズム選択</h4>
            </div>
            <div class="vstack gap-2">
              <div>
                <label for="algorithm" class="form-label mb-1 small text-muted">アルゴリズム</label>
                <select id="algorithm" class="form-select form-select-sm" aria-describedby="algoHelp">
                  <option value="1">貪欲法</option>
                  <option value="2" disabled>焼きなまし（実装予定）</option>
                </select>
              </div>
              <div>
                <label for="numRectangles" class="form-label mb-1 small text-muted">長方形の数</label>
                <input type="number" id="numRectangles" class="form-control form-control-sm" value="500" min="1" max="5000" step="1" inputmode="numeric" aria-describedby="rectHelp" autocomplete="off">
              </div>
            </div>
          </fieldset>

          <!-- STEP 3 -->
          <fieldset class="d-flex flex-column gap-2 border-0 p-0 m-0">
            <legend class="visually-hidden">実行</legend>
            <div class="d-flex align-items-center gap-2">
              <i class="bi bi-3-circle fs-5 text-primary" aria-hidden="true"></i>
              <h4 class="mb-1">実行</h4>
            </div>
            <div class="d-grid gap-2">
              <!-- 実行は1つだけ（結果＝再生前提） -->
              <button class="btn btn-primary" type="button" id="run">
                実行
              </button>
              <div class="form-text small">
                実行後、右のツールバーで再生・保存ができます。
              </div>
            </div>
          </fieldset>

        </form>
      </div>

      <!-- Right: Results -->
      <div class="col-12 col-lg-8 border-start border-1 border-secondary-subtle" aria-labelledby="preview-heading">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <h3 id="preview-heading" class="section-title mb-0">再生・保存</h3>
          <div class="btn-toolbar gap-2">
            <div class="btn-group">
              <button id="save_png" class="btn btn-outline-primary btn-sm" data-requires="result" disabled title="現在のフレームをPNGで保存">
                <i class="bi bi-image" aria-hidden="true"></i> PNG 保存
              </button>
              <button id="save_gif" class="btn btn-outline-primary btn-sm" data-requires="result" disabled title="アニメーションGIFで保存">
                <i class="bi bi-film" aria-hidden="true"></i> GIF 保存
              </button>
              <button id="save_frames" class="btn btn-outline-primary btn-sm" data-requires="result" disabled title="全フレームをPNGでZIP保存">
                <i class="bi bi-images" aria-hidden="true"></i> PNG 全保存
              </button>
            </div>
          </div>
        </div>

        <!-- Toolbar -->
        <fieldset id="sequenceControls" class="toolbar d-flex align-items-center gap-2 flex-wrap flex-lg-nowrap mb-3" data-requires="result" disabled aria-describedby="playbackHelp">
          <button id="play" class="btn btn-primary d-inline-flex align-items-center" aria-pressed="false" title="再生/一時停止">
            <i class="bi bi-play-fill" aria-hidden="true"></i><span class="visually-hidden">再生/一時停止</span>
          </button>

          <label for="t_bar" class="visually-hidden" id="sliderLabel">ターン</label>
          <input type="range" id="t_bar" min="1" max="1" value="1" class="form-range flex-grow-1" aria-labelledby="sliderLabel" />

          <div class="input-group input-group-sm" style="width: 200px;">
            <label class="input-group-text" for="turn">turn</label>
            <input type="number" id="turn" min="1" max="1" value="1" class="form-control text-center" inputmode="numeric" />
          </div>
          <div class="input-group input-group-sm" style="width: 180px;">
            <label class="input-group-text" for="speed">fps</label>
            <input type="number" id="speed" value="100" min="1" max="240" class="form-control text-center" inputmode="numeric" />
          </div>
          <div class="vr d-none d-lg-block mx-2"></div>
          <div class="input-group input-group-sm" style="width: 190px;">
            <label class="input-group-text text-nowrap" id="strokeWidthLabel" for="strokeWidth" title="長方形の枠線の太さ">
              枠線
            </label>
            <input type="number" id="strokeWidth" class="form-control text-center" value="0.5" min="0" max="10" step="0.1" inputmode="decimal" aria-labelledby="strokeWidthLabel" aria-describedby="strokeHelp"/>
          </div>
        </fieldset>

        <!-- Stage -->
        <div class="text-center text-muted flex-grow-1 d-flex">
          <div id="stage" class="ratio ratio-4x3 border rounded bg-body w-100 my-auto" role="img" aria-label="結果表示領域">
            <div class="d-flex align-items-center justify-content-center text-secondary small" data-placeholder>
              <i class="bi bi-image" style="font-size: 2rem;" aria-hidden="true"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="container-xxl my-5 text-center text-muted small">
  <span>© 2025 Rectangle Fitting by
    <a href="https://github.com/Shimo-1999" target="_blank" rel="noopener">Shimo-1999</a>
  </span>
  ·
  <a href="#" data-bs-toggle="modal" data-bs-target="#tosModal">注意 / 免責事項</a>
  </footer>

  <div class="modal fade" id="tosModal" tabindex="-1" aria-labelledby="tosLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="tosLabel" class="modal-title">注意 / 免責事項</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="閉じる"></button>
        </div>
        <div class="modal-body small text-start">
          <p><strong>注意</strong><br>
          画像サイズや解像度が大きい場合、ブラウザや端末のメモリ使用量が増加し、フリーズやクラッシュが発生することがあります。作業中のデータは事前に保存し、十分な電源と余裕のある環境でご利用ください。</p>
          <p><strong>免責事項</strong><br>
          本アプリの利用に関連して発生した損害について、開発者は一切の責任を負いません。</p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./vendor/gif.js"></script>
  <script src="./js/script.js" type="module"></script>
  <script type="module">
    import JSZip from "https://esm.sh/jszip@3.10.1";
    window.JSZip = JSZip;
  </script>

</body>
</html>
